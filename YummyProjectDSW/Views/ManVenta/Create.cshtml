@model yummyApp.Models.Venta

@{
    ViewData["Title"] = "Agregar Venta";

    var usuarios = ViewBag.ListadoUsuarios as List<yummyApp.Models.Usuario> ?? new List<yummyApp.Models.Usuario>();
}

<div class="container mt-5">
    <h1 class="mb-4 display-6 fw-bold text-primary">Agregar Venta</h1>
    <hr />

    <form asp-action="Create" method="post">
        <div class="mb-3">
            <label for="idUsuario" class="form-label">ID Usuario</label>
            <select asp-for="idUsuario" id="idUsuario" class="form-select" required>
                <option value="">--SELECCIONE--</option>
                @foreach (var u in ViewBag.UsuariosJson as List<yummyApp.Models.Usuario>)

                {
                    <option value="@u.idUsuario">@u.idUsuario</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label for="usuario" class="form-label">Nombre de Usuario</label>
            <input type="text" id="usuario" name="usuario" class="form-control" value="" readonly />
        </div>

        <div class="mb-3">
            <label for="fechaVenta" class="form-label">Fecha de Venta</label>
            <input asp-for="fechaVenta" class="form-control" type="date" readonly value="@Model.fechaVenta.ToString("yyyy-MM-dd")" />
        </div>

        <div class="d-flex justify-content-end mt-4">
            <button type="submit" class="btn btn-success px-4">
                Guardar
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        const usuarios = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.UsuariosJson));

        document.getElementById('idUsuario').addEventListener('change', function () {
            const seleccionado = this.value;
            const usuario = usuarios.find(u => u.idUsuario === seleccionado);
            document.getElementById('usuario').value = usuario ? usuario.userName : '';
        });
    </script>
}